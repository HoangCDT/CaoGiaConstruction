@model ProcessStep
@using CaoGiaConstruction.WebClient.Context.Enums
@{
    ViewData["Title"] = Model.Id != Guid.Empty ? "Chỉnh sửa quy trình" : "Thêm mới quy trình";
}

<div class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <div class="page-title-box">
                    <div class="page-title-right">
                        <ol class="breadcrumb m-0">
                            <li class="breadcrumb-item"><a asp-route="admin-default">Trang chủ</a></li>
                            <li class="breadcrumb-item"><a asp-route="admin-process-step">Quy trình làm việc</a></li>
                            <li class="breadcrumb-item active">@ViewData["Title"]</li>
                        </ol>
                    </div>
                    <h4 class="page-title">@ViewData["Title"]</h4>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <form id="form-process-step" method="post" action="/admin/process-step/addorupdate">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="mb-3">
                                        <label for="title" class="form-label">Tiêu đề <span class="text-danger">*</span></label>
                                        <input class="form-control" type="text" name="title" value="@Model.Title" placeholder="Ví dụ: TƯ VẤN, THIẾT KẾ, THI CÔNG, BÀN GIAO" required>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="mb-3">
                                        <label for="description" class="form-label">Mô tả <span class="text-danger">*</span></label>
                                        <textarea class="form-control" name="description" rows="4" placeholder="Vui lòng nhập mô tả chi tiết" required>@Model.Description</textarea>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="sort-order" class="form-label">Vị trí sắp xếp (SortOrder)</label>
                                        <input class="form-control" type="number" id="sort-order" name="sortOrder" value="@Model.SortOrder" placeholder="Vui lòng nhập số thứ tự" min="1">
                                        <small class="text-muted">Số càng nhỏ, hiển thị càng trước. Có thể để trống để tự động gán.</small>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Trạng thái: &nbsp;</label>
                                        <br />
                                        <div>
                                            <input type="checkbox" id="status-active" name="status" @(Model.Status == StatusEnum.Active ? "checked" : "") class="switch-status" data-switch="success">
                                            <label for="status-active" data-on-label="Yes" data-off-label="No" class="mb-0 d-block"></label>
                                        </div>
                                    </div>
                                </div>

                                @if (Model.Id != Guid.Empty)
                                {
                                    <input type="hidden" name="id" value="@Model.Id" />
                                }
                            </div>

                            <div class="row mt-3">
                                <div class="col-12">
                                    <button type="submit" class="btn btn-success"><i class="mdi mdi-content-save"></i> Lưu lại</button>
                                    <a asp-route="admin-process-step" class="btn btn-secondary">Hủy</a>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script>
        $(function() {
            $("#form-process-step").validate({
                rules: {
                    title: { required: true },
                    description: { required: true }
                },
                messages: {
                    title: { required: "Vui lòng nhập tiêu đề" },
                    description: { required: "Vui lòng nhập mô tả" }
                },
                submitHandler: function(form) {
                    var formData = new FormData(form);
                    var data = {};
                    for (var pair of formData.entries()) {
                        data[pair[0]] = pair[1];
                    }
                    if (data.status != null && data.status != undefined) {
                        data.status = (data.status == 'on') ? 1 : 0;
                    } else {
                        data.status = 0;
                    }
                    
                    $.ajax({
                        url: '/admin/process-step/addorupdate',
                        type: 'POST',
                        data: data,
                        success: function(result) {
                            if (result.success) {
                                showToastSuccess("Thêm mới dữ liệu thành công");
                                window.location.href = '/admin/process-step';
                            } else {
                                showToastError(result.message);
                            }
                        },
                        error: function() {
                            showToastError("Thêm mới dữ liệu thất bại");
                        }
                    });
                }
            });
        });
    </script>
}
