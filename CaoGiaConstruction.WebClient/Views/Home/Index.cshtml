<!-- Banner -->
@await Html.PartialAsync("_SlideTopHome")

<div class="main-content home-wrapper">
    <div class="page-content">

        @* Máy móc nổi bật *@
        @await Component.InvokeAsync(nameof(vcHotMachine))

        @* Sản phẩm nổi bật *@
        @await Component.InvokeAsync(nameof(vcHotProduct))

        @* About *@
        @await Component.InvokeAsync(nameof(vcAboutHome))

        @* TikTok Embed - Lazy Load *@
        <div id="tiktok-embed-container"></div>
          @* @await Html.PartialAsync("_TiktokEmbed") *@

        @* Chi nhánh*@
        @await Component.InvokeAsync(nameof(vcBranchesV2))

        @* Dịch vụ *@
        @await Component.InvokeAsync(nameof(vcService))

        @* Blog Home *@
        @await Component.InvokeAsync(nameof(vcBlogHome))

        @* Video *@
        @await Component.InvokeAsync(nameof(vcVideo))

        @* Cảm nhận khách hàng *@
        @await Component.InvokeAsync(nameof(vcFeedback))

    </div>
</div>

@section styles {
    <link rel="stylesheet" href="~/Client/css/nivo-slider.css">
}

@section scripts {
    <script src="~/Client/js/vendor/jquery.nivo.slider.pack.js"></script>
    <script>
        // Debug: Log số lượng img elements trong slider
        $(document).ready(function() {
            // Log sau khi Nivo Slider đã khởi tạo
            setTimeout(function() {
                const $slider = $('#banner .nivoSlider');
                if ($slider.length > 0) {
                    // Tất cả img trong slider (bao gồm cả .nivo-main-image và .nivo-slice)
                    const allImgs = $slider.find('img');
                    console.log('=== DEBUG SLIDER IMAGES ===');
                    console.log('Tổng số img elements trong slider:', allImgs.length);
                    
                    // Nhóm theo src
                    const imgGroups = {};
                    allImgs.each(function(index) {
                        const src = $(this).attr('src');
                        const className = $(this).attr('class') || 'no-class';
                        if (!imgGroups[src]) {
                            imgGroups[src] = [];
                        }
                        imgGroups[src].push({
                            index: index,
                            class: className,
                            src: src
                        });
                    });
                    
                    console.log('Nhóm theo src:');
                    Object.keys(imgGroups).forEach(function(src) {
                        console.log(`  ${src}: ${imgGroups[src].length} img(s)`);
                        imgGroups[src].forEach(function(img) {
                            console.log(`    - Index: ${img.index}, Class: ${img.class}`);
                        });
                    });
                    
                    // Log HTML source của slider
                    console.log('HTML của slider:', $slider[0].outerHTML.substring(0, 500) + '...');
                }
            }, 2000); // Delay 2s để đảm bảo Nivo Slider đã khởi tạo xong
            
            // Load TikTok embed sau một khoảng delay nhỏ để không chặn trang chính
            setTimeout(function() {
                loadTiktokEmbed();
            }, 500); // Delay 500ms để đảm bảo trang chính đã render xong
        });

        function loadTiktokEmbed() {
            const container = $('#tiktok-embed-container');
            if (container.length === 0) {
                return;
            }

            $.ajax({
                url: '/api/tiktok-embed',
                method: 'GET',
                cache: false,
                timeout: 10000 // 10 seconds timeout
            })
            .done(function(response) {
                if (response && response.success && response.html) {
                    container.html(response.html);
                }
            })
            .fail(function(xhr, status, error) {
                console.log('Failed to load TikTok embed:', error);
                // Không hiển thị lỗi cho user, chỉ log để debug
            });
        }
    </script>
}