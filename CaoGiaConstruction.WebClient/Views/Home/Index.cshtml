@{
    var homeComponents = ViewBag.HomeComponentConfigs as List<HomeComponentConfig> ?? new List<HomeComponentConfig>();
    Func<string, bool> isPartial = key =>
        !string.IsNullOrWhiteSpace(key) &&
        (key.StartsWith("_") || key.Contains("/") || key.EndsWith(".cshtml", StringComparison.OrdinalIgnoreCase));
    var componentIndex = 0;
}

<div class="main-content home-wrapper">
    <div class="page-content">
        @foreach (var component in homeComponents)
        {
            if (string.IsNullOrWhiteSpace(component.ComponentKey))
            {
                continue;
            }

            componentIndex++;
            <div class="home-component" data-index="@componentIndex">
                @if (isPartial(component.ComponentKey))
                {
                    @await Html.PartialAsync(component.ComponentKey)
                }
                else
                {
                    @await Component.InvokeAsync(component.ComponentKey)
                }

                @if (!string.IsNullOrWhiteSpace(component.Javascript))
                {
                    <script>
@Html.Raw(component.Javascript)
                    </script>
                }
            </div>
        }
    </div>
</div>

@section styles {
    <link rel="stylesheet" href="~/Client/css/nivo-slider.css">
    <link rel="stylesheet" href="~/Client/css/home.css" asp-append-version="true">
}

@section scripts {
    <script src="~/Client/js/vendor/jquery.nivo.slider.pack.js"></script>
    <script>
        // Debug: Log số lượng img elements trong slider
        $(document).ready(function() {
            // Log sau khi Nivo Slider đã khởi tạo
            setTimeout(function() {
                const $slider = $('#banner .nivoSlider');
                if ($slider.length > 0) {
                    // Tất cả img trong slider (bao gồm cả .nivo-main-image và .nivo-slice)
                    const allImgs = $slider.find('img');
                    console.log('=== DEBUG SLIDER IMAGES ===');
                    console.log('Tổng số img elements trong slider:', allImgs.length);
                    
                    // Nhóm theo src
                    const imgGroups = {};
                    allImgs.each(function(index) {
                        const src = $(this).attr('src');
                        const className = $(this).attr('class') || 'no-class';
                        if (!imgGroups[src]) {
                            imgGroups[src] = [];
                        }
                        imgGroups[src].push({
                            index: index,
                            class: className,
                            src: src
                        });
                    });
                    
                    console.log('Nhóm theo src:');
                    Object.keys(imgGroups).forEach(function(src) {
                        console.log(`  ${src}: ${imgGroups[src].length} img(s)`);
                        imgGroups[src].forEach(function(img) {
                            console.log(`    - Index: ${img.index}, Class: ${img.class}`);
                        });
                    });
                    
                    // Log HTML source của slider
                    console.log('HTML của slider:', $slider[0].outerHTML.substring(0, 500) + '...');
                }
            }, 2000); // Delay 2s để đảm bảo Nivo Slider đã khởi tạo xong
            
        });
    </script>
}